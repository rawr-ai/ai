# Missing Documentation Proposal: CLI Refactoring (YAML for Global Modes)

**Date:** 2025-04-10

This document outlines critical documentation identified as missing for the refactoring effort focused on using `config.yaml` to update the global `custom_modes.json` registry. The existing documentation (`implementation_plan_scoped.md`, `refactoring_map.md`, `config_findings.md`) provides a plan and context, but the following specific artifacts are needed to guide implementation, ensure consistency, and facilitate future maintenance.

## Proposed Missing Documents:

1.  **`config_yaml_schema_global.md`**
    *   **Rationale:** The `implementation_plan_scoped.md` (P0.1) requires finalizing the canonical YAML schema fields relevant *specifically* to updating `custom_modes.json`. This document is needed to formally define the required structure, fields, data types, and validation rules for the `config.yaml` files in this specific context. It serves as the definitive reference for both developers implementing the parser/validator (`config_loader.py`, Pydantic models) and users creating/migrating agent configurations.

2.  **`global_registry_access.md`**
    *   **Rationale:** Both `implementation_plan_scoped.md` (A.2) and `config_findings.md` note that the exact location and access method for the global `custom_modes.json` are assumed or implied, but not explicitly documented. This document is crucial to specify the definitive path, necessary permissions, and any assumptions made by the `registry_manager.py` component for reliably reading and writing to this central file.

3.  **`rollback_strategy_global.md`**
    *   **Rationale:** The `implementation_plan_scoped.md` (Task 4.1) mandates defining a rollback strategy. This document is needed to detail the specific procedures, potential failure points, backup mechanisms (e.g., backing up `custom_modes.json` before write), and steps required to revert the system to a known good state if the new YAML-based update process for the global registry fails. This is essential for operational stability.

4.  **`testing_strategy_global.md`**
    *   **Rationale:** While the implementation plan mentions testing (Task 4.2, 3.3), a dedicated document is needed to outline the *specific* testing approach for the global update pathway. This should include details on unit tests for new modules (`config_loader`, `compiler`, `registry_manager`), integration tests for the `cli compile` command's global path, and functional equivalence tests comparing the output (`custom_modes.json`) generated by the old method versus the new YAML method.

5.  **`migration_plan_global.md`**
    *   **Rationale:** Phase 5 of the implementation plan involves migrating existing global modes. This document should detail the migration process, including the design and usage of the migration script (Task 5.1), the specific validation steps to ensure data integrity (Task 5.2), and the final verification process (Task 5.4). It provides a clear guide for executing the transition smoothly.

6.  **`cli_usage_guide_yaml_global.md`**
    *   **Rationale:** The implementation plan (Task 4.3) requires updating CLI documentation. This specific guide is needed to explain to end-users how the `cli compile` command now works with `config.yaml` files *specifically for managing global modes*. It should cover command syntax, expected file locations, feedback messages, and troubleshooting common issues related to the global scope.

Creating these documents will provide necessary clarity, reduce ambiguity during implementation, ensure testability, and support the long-term maintainability of the refactored CLI system.